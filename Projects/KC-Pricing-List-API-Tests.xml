<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="91890414-4fd9-422e-a98d-a5b611df8d40" activeEnvironment="CI" name="P03 - KC - Pricing List" resourceRoot="" soapui-version="5.1.2" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" id="1701d990-4b4f-491e-8f24-fd0685e2656e" wadlVersion="http://wadl.dev.java.net/2009/02" name="ReadSpecifiedPriceList" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>${#Project#endpoint}</con:endpoint></con:endpoints><con:resource name="Pricelist" path="/${#Project#endpath}/pricelist/{pricingtableID}" id="5dcff086-10a4-44cf-8d77-18b9eb3a37a4"><con:settings/><con:parameters><con:parameter><con:name>pricingtableID</con:name><con:style>TEMPLATE</con:style></con:parameter></con:parameters><con:method name="Pricetable" id="a406498c-1493-4ad1-bf20-7130be8e0357" method="GET"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>text/html;charset=utf-8</con:mediaType><con:status>404</con:status><con:params/><con:element>html</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/xml</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:ns="http://wsapi.guthy-renker.com/soma-schema/pricelist/201501">ns:snapshot</con:element></con:representation><con:representation type="FAULT"><con:mediaType>application/xml</con:mediaType><con:status>400</con:status><con:params/><con:element>response</con:element></con:representation><con:request name="Request" id="224f5d48-1379-4ecb-a39a-662c02e74deb" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:request/><con:originalUri>http://10.92.41.155//pricelist/LCD95R3</con:originalUri><con:credentials><con:username xsi:nil="true"/><con:password xsi:nil="true"/><con:domain xsi:nil="true"/><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="pricingtableID" value="LCD95R3" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>pricingtableID</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="3b636268-7b76-47c7-ada4-03992dad0f69" wadlVersion="http://wadl.dev.java.net/2009/02" name="ChangedPricelist" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>${#Project#endpoint}</con:endpoint></con:endpoints><con:resource name="Changed" path="/${#Project#endpath}/pricelists/changed?after={changeddate}" id="b96e90ad-e262-422c-85ee-4a4dc1889683"><con:settings/><con:parameters><con:parameter><con:name>changeddate</con:name><con:value>2014-07-26T12:30:00-0700</con:value><con:style>TEMPLATE</con:style><con:default>2014-07-26T12:30:00-0700</con:default></con:parameter></con:parameters><con:method name="Changed" id="1cb1929c-fe83-4979-9503-7cd7fd23a904" method="GET"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/xml</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:ns="http://wsapi.guthy-renker.com/soma-schema/pricelist/201501">ns:snapshots</con:element></con:representation><con:request name="Request" id="2fe88efa-27dc-4db9-9052-d3a59df2105d" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:request/><con:originalUri>http://mocksvc.mulesoft.com/mocks/bfe5b887-f0c1-4d0b-be73-77edc53ee320/soma-ws/v1/snapshot/pricelists/changed</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>changeddate</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="0b46a900-7505-4aa2-8345-4926fbcafb23" wadlVersion="http://wadl.dev.java.net/2009/02" name="Searchpricelist" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>${#Project#endpoint}</con:endpoint></con:endpoints><con:resource name="Searchpricelists" path="/${#Project#endpath}/pricelists?filter={searchcriteria}" id="8ca33a21-35c8-4cdc-ab39-00e483623de2"><con:settings/><con:parameters><con:parameter><con:name>searchcriteria</con:name><con:value>status:in(V,A);currency:eq(USD)</con:value><con:style>TEMPLATE</con:style><con:default>status:in(V,A);currency:eq(USD)</con:default></con:parameter></con:parameters><con:method name="Searchpricelists" id="4d5636fb-5990-4767-b597-ec9f58f54e4e" method="GET"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/xml</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:ns="http://wsapi.guthy-renker.com/soma-schema/pricelist/201501">ns:snapshots</con:element></con:representation><con:request name="Request" id="5356375f-3892-4c06-9298-b17b2dcefe3d" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:request/><con:originalUri>http://mocksvc.mulesoft.com/mocks/bfe5b887-f0c1-4d0b-be73-77edc53ee320/soma-ws/v1/snapshot/pricelists/changed</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>searchcriteria</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:testSuite id="dae853fb-614c-49d6-ba04-2407d717d278" name="TS01 - Read Specific Price List"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="f8e7f640-c595-494c-834d-32040eb11ed8" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC01 - Schema Validation" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="1c615472-8abe-4267-83db-5787fea0da82"><con:settings/><con:config service="ReadSpecifiedPriceList" resourcePath="/${#Project#endpath}/pricelist/{pricingtableID}" methodName="Pricetable" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="6c475e55-2431-4c1c-8618-c985de686ca5" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding/><con:endpoint>${#Project#endpoint}/</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/shippingtable/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="pricingtableID" value="LCD95R3" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>shippingtableID</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="ValidateSchema" id="91a2251d-747d-42c7-bc46-2445005d72eb"><con:settings/><con:config><script>import javax.xml.XMLConstants
import javax.xml.transform.stream.StreamSource
import javax.xml.validation.SchemaFactory
def response = context.expand( '${GetPricingInfo#ResponseAsXml}' )
def xsdFile = context.expand( '${#Project#xsdFile}' )

log.info xsdFile
new File( xsdFile).withReader { xsd ->
  SchemaFactory.newInstance( XMLConstants.W3C_XML_SCHEMA_NS_URI )
               .newSchema( new StreamSource( xsd ) )
               .newValidator()
               .validate( new StreamSource( new StringReader( response ) ) )

}
//
//import javax.xml.XMLConstants
//import javax.xml.transform.stream.StreamSource
//import javax.xml.validation.*
//// setup validator
//Validator validator;
//def url = "E:\\GR\\KC\\shippingtable-schema.xsd"
//log.info url
//URI uri = new URI(url);
//InputStream inp = uri.toURL().openStream();
//try
//{
//SchemaFactory factory =
//SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
//StreamSource entitySs = new StreamSource(inp);
//Schema schema = factory.newSchema(entitySs);
//assert(schema != null);
//validator = schema.newValidator();
//}
//finally
//{
//inp.close();
//inp = null;
//}
//
//
//
//def response = context.expand( '${GetPricingInfo#ResponseAsXml}' )
//
//
//
//log.info response
//validator.validate(new StreamSource(new StringReader(response)))</script></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase id="82cb4b00-9e0f-486e-97bd-7d2fca07e088" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC02 - Response Code Validation" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="2d621e13-dbc8-414c-8d87-583201d24ce0"><con:settings/><con:config service="ReadSpecifiedPriceList" resourcePath="/${#Project#endpath}/pricelist/{pricingtableID}" methodName="Pricetable" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="6c475e55-2431-4c1c-8618-c985de686ca5" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/shippingtable/</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="591f950e-8ef5-4daa-87ae-3f20a2e8e739" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Invalid HTTP Status Codes" id="93b7b087-625e-41a8-8282-dd9761dfb127" name="Invalid HTTP Status Codes"><con:configuration><codes>410</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="pricingtableID" value="LCD95R3" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>shippingtableID</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase id="783e3862-ea19-40ca-8b53-8669dcff246a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC03 - CurrentAsOf Date Validation" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="14a9b5a9-48f3-48e7-8fd5-0cf848b238d2"><con:settings/><con:config service="ReadSpecifiedPriceList" resourcePath="/${#Project#endpath}/pricelist/{pricingtableID}" methodName="Pricetable" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="6c475e55-2431-4c1c-8618-c985de686ca5" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/shippingtable/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="pricingtableID" value="LCD95R3" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>shippingtableID</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:properties/><con:reportParameters/></con:testSuite><con:testSuite id="1051bc71-cb34-422d-ab26-e23db9f08055" name="TS02 - Read Changed Price List"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="be70523b-e03c-4f54-b2f2-20ecf51e7241" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC01 - Schema Validation" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="c79857ca-b71c-466e-960c-c8e1d748d034"><con:settings/><con:config service="ChangedPricelist" resourcePath="/${#Project#endpath}/pricelists/changed?after={changeddate}" methodName="Changed" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="078994f9-c4b2-4096-b7fd-116f80892ff4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}/</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/changedshippingtables/</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>shippingtableID</con:entry><con:entry>changeddate</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="ValidateSchema" id="379839d7-6116-4918-8294-64198ab29161"><con:settings/><con:config><script>import javax.xml.XMLConstants
import javax.xml.transform.stream.StreamSource
import javax.xml.validation.SchemaFactory
def response = context.expand( '${GetPricingInfo#ResponseAsXml}' )
def xsdFile = context.expand( '${#Project#xsdFile}' )

log.info xsdFile
new File( xsdFile).withReader { xsd ->
  SchemaFactory.newInstance( XMLConstants.W3C_XML_SCHEMA_NS_URI )
               .newSchema( new StreamSource( xsd ) )
               .newValidator()
               .validate( new StreamSource( new StringReader( response ) ) )

}
//
//import javax.xml.XMLConstants
//import javax.xml.transform.stream.StreamSource
//import javax.xml.validation.*
//// setup validator
//Validator validator;
//def url = "E:\\GR\\KC\\shippingtable-schema.xsd"
//log.info url
//URI uri = new URI(url);
//InputStream inp = uri.toURL().openStream();
//try
//{
//SchemaFactory factory =
//SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
//StreamSource entitySs = new StreamSource(inp);
//Schema schema = factory.newSchema(entitySs);
//assert(schema != null);
//validator = schema.newValidator();
//}
//finally
//{
//inp.close();
//inp = null;
//}
//
//
//
//def response = context.expand( '${GetPricingInfo#ResponseAsXml}' )
//
//
//
//log.info response
//validator.validate(new StreamSource(new StringReader(response)))</script></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>ba006a60-8401-44c0-917c-672ed9bf6267</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase id="14a4cc5a-5de5-41fa-97cc-85681304a7f4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC02 - Response Code Validation" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="d0b7de4e-580f-4d24-ac4a-43116b4a864e"><con:settings/><con:config service="ChangedPricelist" resourcePath="/${#Project#endpath}/pricelists/changed?after={changeddate}" methodName="Changed" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="078994f9-c4b2-4096-b7fd-116f80892ff4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}/</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/changedshippingtables/</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="98f0c3c6-1ac2-41bd-80d9-a85245a946be" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Invalid HTTP Status Codes" id="c19afdf1-9aff-49d4-91e5-a84ab6dea4e1" name="Invalid HTTP Status Codes"><con:configuration><codes>400</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>shippingtableID</con:entry><con:entry>changeddate</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase id="d5e20ef9-f73d-4157-87e7-a54f1ee07cd4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC03 - CurrentAsOf Date Validation" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="a6a48ece-1318-4ff0-adac-e0c8141f0659"><con:settings/><con:config service="ChangedPricelist" resourcePath="/${#Project#endpath}/pricelists/changed?after={changeddate}" methodName="Changed" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="078994f9-c4b2-4096-b7fd-116f80892ff4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}/</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/changedshippingtables/</con:originalUri><con:assertion type="XPath Match" id="8eb82a25-b690-4f51-90ed-efe413dc577c" name="Check count of [currentAsOf]"><con:configuration><path>declare namespace ns1='http://wsapi.guthy-renker.com/soma-schema/shipping/201501';
count( //ns1:snapshots/ns1:currentAsOf)</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>shippingtableID</con:entry><con:entry>changeddate</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase id="de72501d-d36b-497c-b456-cb6575f1939e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC08 - Response Code Validation - MaximumLimitExceeded" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="a7359d39-8053-4b11-9e55-295c02b28656"><con:settings/><con:config service="ChangedPricelist" resourcePath="/${#Project#endpath}/pricelists/changed?after={changeddate}" methodName="Changed" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="078994f9-c4b2-4096-b7fd-116f80892ff4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}/</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/changedshippingtables/</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="98f0c3c6-1ac2-41bd-80d9-a85245a946be" name="Valid HTTP Status Codes"><con:configuration><codes>500</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="changeddate" value="2014-07-26T12:30:00-0700123" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>shippingtableID</con:entry><con:entry>changeddate</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase id="09be84d9-6a6f-40dd-bad2-cc16d78b6c66" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC07 - Response Code Validation - OutOfRange" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="4430d36d-8be5-4e6d-a340-37ecf698ea1c"><con:settings/><con:config service="ChangedPricelist" resourcePath="/${#Project#endpath}/pricelists/changed?after={changeddate}" methodName="Changed" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="078994f9-c4b2-4096-b7fd-116f80892ff4" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}/</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/changedshippingtables/</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="98f0c3c6-1ac2-41bd-80d9-a85245a946be" name="Valid HTTP Status Codes"><con:configuration><codes>400</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="changeddate" value="2014-07-26T12:30:00-0700123" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>shippingtableID</con:entry><con:entry>changeddate</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:properties/><con:reportParameters/></con:testSuite><con:testSuite id="6d2e6f89-c73f-492a-8fe6-00a6f5c23d66" name="TS03 - Search for Pricing List"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="e3106a76-1ee9-4330-bc73-4d7ffb28eddd" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC01 - Schema Validation" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="bc351dce-0bd0-474a-9a64-6e697467cb00"><con:settings/><con:config service="Searchpricelist" resourcePath="/${#Project#endpath}/pricelists?filter={searchcriteria}" methodName="Searchpricelists" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="88ea6ab4-0937-45d4-beaf-8f2f1a0de6e8" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/searchshippingtables</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="f8739064-50b5-4f73-bc83-3884c460a2bd" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>searchcriteria</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="ValidateSchema" id="3e0d54af-cc3b-4008-8592-14f260b57ad9"><con:settings/><con:config><script>import javax.xml.XMLConstants
import javax.xml.transform.stream.StreamSource
import javax.xml.validation.SchemaFactory
def response = context.expand( '${GetPricingInfo#ResponseAsXml}' )
def xsdFile = context.expand( '${#Project#xsdFile}' )

log.info xsdFile
new File( xsdFile).withReader { xsd ->
  SchemaFactory.newInstance( XMLConstants.W3C_XML_SCHEMA_NS_URI )
               .newSchema( new StreamSource( xsd ) )
               .newValidator()
               .validate( new StreamSource( new StringReader( response ) ) )

}
//
//import javax.xml.XMLConstants
//import javax.xml.transform.stream.StreamSource
//import javax.xml.validation.*
//// setup validator
//Validator validator;
//def url = "E:\\GR\\KC\\shippingtable-schema.xsd"
//log.info url
//URI uri = new URI(url);
//InputStream inp = uri.toURL().openStream();
//try
//{
//SchemaFactory factory =
//SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
//StreamSource entitySs = new StreamSource(inp);
//Schema schema = factory.newSchema(entitySs);
//assert(schema != null);
//validator = schema.newValidator();
//}
//finally
//{
//inp.close();
//inp = null;
//}
//
//
//
//def response = context.expand( '${GetPricingInfo#ResponseAsXml}' )
//
//
//
//log.info response
//validator.validate(new StreamSource(new StringReader(response)))</script></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>6a2d0aec-cbcb-4769-842b-6dc42fcb42a5</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase><con:testCase id="333e95f4-e9d9-4b11-a256-84e2d76af979" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC02 - Response Code Validation" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="13fdfd71-7a12-47fb-a0cd-9f26e7d88af8"><con:settings/><con:config service="Searchpricelist" resourcePath="/${#Project#endpath}/pricelists?filter={searchcriteria}" methodName="Searchpricelists" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="88ea6ab4-0937-45d4-beaf-8f2f1a0de6e8" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/searchshippingtables</con:originalUri><con:assertion type="Invalid HTTP Status Codes" id="dc7bbfed-02ce-4b1f-b47d-db02a73faa8e" name="Invalid HTTP Status Codes"><con:configuration><codes>400</codes></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="82183d41-0092-48ad-a6ff-b0885d8d5907" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>searchcriteria</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase id="88fccf50-1a4c-4297-b0e1-397c4ce60f16" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC03 - CurrentAsOf Date Validation" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="276f2bc9-7a3e-4a72-beb5-87db337f24fc"><con:settings/><con:config service="Searchpricelist" resourcePath="/${#Project#endpath}/pricelists?filter={searchcriteria}" methodName="Searchpricelists" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="88ea6ab4-0937-45d4-beaf-8f2f1a0de6e8" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/searchshippingtables</con:originalUri><con:assertion type="XPath Match" id="24431945-bc5d-484f-8181-d4d137b42d3e" name="Check count of [currentAsOf]"><con:configuration><path>declare namespace ns1='http://wsapi.guthy-renker.com/soma-schema/shipping/201501';
count( //ns1:snapshots/ns1:currentAsOf)</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="67e5c6c3-f72c-4384-9b96-d770bafd9073" name="Check count of [@query]"><con:configuration><path>declare namespace ns1='http://wsapi.guthy-renker.com/soma-schema/shipping/201501';
count( //ns1:snapshots/@query)</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="Valid HTTP Status Codes" id="55d41309-58d0-48e4-8ff7-af610615e5b9" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>searchcriteria</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase id="c7ec59d8-78db-4eaf-8c9f-2fd50b27ca2b" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC07 - Response Code Validation - MaximumLimitExceeded" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="07c11fa0-167b-46d8-95cb-e70732dd3bbf"><con:settings/><con:config service="Searchpricelist" resourcePath="/${#Project#endpath}/pricelists?filter={searchcriteria}" methodName="Searchpricelists" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="88ea6ab4-0937-45d4-beaf-8f2f1a0de6e8" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/searchshippingtables</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="104aed8f-c711-4f26-96e1-0efac39a70aa" name="Valid HTTP Status Codes"><con:configuration><codes>500</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>searchcriteria</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:testCase id="8f68b842-006a-43ff-abcf-d7d7f4969db9" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TC08 - Response Code Validation - InvalidQueryString" searchProperties="true"><con:settings><con:setting id="IncludeOverview">true</con:setting><con:setting id="IncludeResults">true</con:setting><con:setting id="FlowLayout">false</con:setting><con:setting id="ErrorDetails">true</con:setting><con:setting id="IncludeCoverage">true</con:setting><con:setting id="GeneratableJUnitReport@Style">Single Page (Print)</con:setting><con:setting id="GeneratableJUnitReport@Folder"/></con:settings><con:testStep type="restrequest" name="GetPricingInfo" id="7bbc53bd-57bf-4381-b300-5ce751389a79"><con:settings/><con:config service="Searchpricelist" resourcePath="/${#Project#endpath}/pricelists?filter={searchcriteria}" methodName="Searchpricelists" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPricingInfo" id="88ea6ab4-0937-45d4-beaf-8f2f1a0de6e8" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>${#Project#endpoint}</con:endpoint><con:request/><con:originalUri>http://localhost/snapshot/searchshippingtables</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="368633d4-fcb7-4a7e-88b5-d135321f0212" name="Valid HTTP Status Codes"><con:configuration><codes>400</codes></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder><con:entry>searchcriteria</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties/><con:reportParameters/></con:testCase><con:properties/><con:reportParameters/></con:testSuite><con:endpointStrategy xsi:type="con:DefaultEndpointStrategy" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:endpoint mode="OVERRIDE">${#Project#endpoint}</con:endpoint></con:endpointStrategy><con:requirements/><con:properties><con:property><con:name>endpoint</con:name><con:value>http://localhost:8084/</con:value></con:property><con:property><con:name>xsdFile</con:name><con:value/></con:property><con:property><con:name>username</con:name><con:value/></con:property><con:property><con:name>password</con:name><con:value/></con:property><con:property><con:name>ActiveEnv</con:name><con:value>CI</con:value></con:property><con:property><con:name>endpath</con:name></con:property></con:properties><con:afterLoadScript>import groovy.util.*
import java.io.File	// You need Java File utils
def groovyUtils = new com.eviware.soapui.support.GroovyUtils(context)
// Get projects active environment
log.info "Active Environment set to : "+ project.activeEnvironment.name 
def active_env = context.expand( '${#Project#ActiveEnv}')

// Set this as active environment
project.setActiveEnvironment(active_env)
log.info "Confirm Active Env name: " + project.activeEnvironment.name

// Get SoapUI Groovy Utils
groovyUtils = new com.eviware.soapui.support.GroovyUtils(context)

// Get Confg File Location
def ws = new File(groovyUtils.projectPath).getParentFile()
def confFile = ws.toString() + "/Config/pricinglist_soapui.properties.groovy"
log.info "Config File Name is: " + confFile

// Find active environment and get the endpoint URL
def config = new ConfigSlurper().parse(new File(confFile).toURL())
def env = config.active_env
log.info " - Active Environment is: " + env
def endpoint = config.endpoints."$env".endpoint
def path = config.endpoints."$env".endpath

// Set project level property
project.setPropertyValue( "endpoint",endpoint )
project.setPropertyValue( "endpath",path )
log.info "Path - " +path
def username = config.http_auth.username
def password = config.http_auth.password
log.info " - HTTP Authentication user name/password : " + username + " / "+ password
project.setPropertyValue( "username",username )
project.setPropertyValue( "password",password )


TimeZone.setDefault(TimeZone.getTimeZone('UTC'))
def afterValue=new Date().format("yyyy-MM-dd'T'HH:mm:ss'Z'")
log.info "After at load.."+afterValue 

// Set default values for 'filter' and 'after'
project.setPropertyValue( "after",afterValue)
project.setPropertyValue( "filter","web" )
project.setPropertyValue( "s_after",afterValue)
String xsdfilepath = groovyUtils.getProjectPath().replaceAll("Projects" , "XSD")+ "\\pricelist-schema.xsd"
project.setPropertyValue( "xsdFile",xsdfilepath)

</con:afterLoadScript><con:wssContainer/><con:databaseConnectionContainer/><con:oAuth2ProfileContainer/><con:reporting><con:reportTemplates/><con:xmlTemplates/><con:parameters/></con:reporting><con:sensitiveInformation/><con:environment name="CI"><con:service type="REST" name="ReadSpecifiedPriceList"><con:endpoint>${#Project#endpoint}</con:endpoint></con:service><con:service type="REST" name="ChangedPricelist"><con:endpoint>${#Project#endpoint}</con:endpoint></con:service><con:service type="REST" name="Searchpricelist"><con:endpoint>${#Project#endpoint}</con:endpoint></con:service><con:property><con:name>endpoint</con:name><con:value>http://mocksvc.mulesoft.com</con:value></con:property><con:property><con:name>xsdFile</con:name><con:value>E:\GR\SOMA\XSD\pricelist-schema.xsd</con:value></con:property><con:property><con:name>username</con:name><con:value>somapi-autotest</con:value></con:property><con:property><con:name>password</con:name><con:value>p4$$W0rd</con:value></con:property><con:property><con:name>ActiveEnv</con:name><con:value>CI</con:value></con:property><con:property><con:name>path</con:name><con:value>soma-ws-ci</con:value></con:property><con:property><con:name>after</con:name><con:value>2015-02-25T19:09:55Z</con:value></con:property><con:property><con:name>filter</con:name><con:value>web</con:value></con:property><con:property><con:name>s_after</con:name><con:value>2015-02-25T19:09:55Z</con:value></con:property><con:property><con:name>endpath</con:name><con:value>mocks/bfe5b887-f0c1-4d0b-be73-77edc53ee320/soma-ws/v1/snapshot</con:value></con:property><con:databaseConnectionContainer/></con:environment></con:soapui-project>